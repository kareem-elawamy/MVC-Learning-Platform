@model ONE.DTOs.TrackMaterialDTO

<h2 class="text-center">Manage Tracks & Materials</h2>

<div class="row">
    <!-- ✅ Tracks Table -->
    <div class="col-md-6">
        <h4>Tracks</h4>
        <button class="btn btn-success mb-2" data-bs-toggle="modal" data-bs-target="#trackModal">Add Track</button>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var track in Model.Tracks)
                {
                    <tr>
                        <td>@track.Id</td>
                        <td>@track.Name</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteTrack(@track.Id)">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- ✅ Materials Table -->
    <div class="col-md-6">
        <h4>Materials</h4>
        <button class="btn btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#materialModal">Add Material</button>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Track</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var material in Model.Materials)
                {
                    <tr>
                        <td>@material.Id</td>
                        <td>@material.Name</td>
                        <td>@material.Track.Name</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteMaterial(@material.Id)">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- ✅ Add Track Modal -->
<div class="modal fade" id="trackModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Track</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="text" id="trackName" class="form-control" placeholder="Track Name">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" onclick="addTrack()">Add</button>
            </div>
        </div>
    </div>
</div>

<!-- ✅ Add Material Modal -->
<div class="modal fade" id="materialModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Material</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="text" id="materialName" class="form-control mb-2" placeholder="Material Name">
                <select id="trackId" class="form-select">
                    <option value="">Select Track</option>
                    @foreach (var track in Model.Tracks)
                    {
                        <option value="@track.Id">@track.Name</option>
                    }
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addMaterial()">Add</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // ✅ Add Track
        function addTrack() {
            let name = document.getElementById("trackName").value;
            if (!name) return alert("Please enter track name");

            fetch("/Admin/AddTrack", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ Name: name })
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert("Error adding track");
                }
            });
        }

        // ✅ Add Material
        function addMaterial() {
            let name = document.getElementById("materialName").value;
            let trackId = document.getElementById("trackId").value;
            if (!name || !trackId) return alert("Please enter all fields");

            fetch("/Admin/AddMaterial", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ Name: name, TrackId: trackId })
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert("Error adding material");
                }
            });
        }

        // ✅ Delete Track
        function deleteTrack(id) {
            if (!confirm("Are you sure you want to delete this track?")) return;

            fetch(`/Admin/DeleteTrack/${id}`, {
                method: "DELETE"
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert("Error deleting track");
                }
            });
        }

        // ✅ Delete Material
        function deleteMaterial(id) {
            if (!confirm("Are you sure you want to delete this material?")) return;

            fetch(`/Admin/DeleteMaterial/${id}`, {
                method: "DELETE"
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert("Error deleting material");
                }
            });
        }
    </script>
}
